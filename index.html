<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baccarat SS Machine Simulator</title>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; }
  button { margin: 5px; padding: 12px; font-size: 18px; min-width: 60px; margin: 3px; }
  #deckList, #nextCard, #probabilities, #history { margin-top: 10px; font-size: 16px; word-wrap: break-word; }
  .card-buttons, .control-buttons { display: flex; flex-wrap: wrap; justify-content: center; margin: 10px 0; }
  h2 { margin-top: 20px; }
</style>
</head>
<body>
<h1>Baccarat SS Machine Simulator</h1>

<div class="control-buttons">
  <button onclick="initializeMachine()">Initialize Machine</button>
  <button onclick="shuffleDeck()">Shuffle (Riffle Style)</button>
  <button onclick="dealCards(5)">Deal Next 5 Cards</button>
  <button onclick="shuffleBack()">Shuffle Back (Insert History)</button>
  <button onclick="resetDeck()">Reset</button>
</div>

<h2>Deck Info:</h2>
<div id="deckList">Empty</div>

<h2>Next Cards:</h2>
<div id="nextCard">-</div>

<h2>Card Probabilities:</h2>
<div id="probabilities">-</div>

<h2>History (Dealt Cards):</h2>
<div id="history">-</div>

<script>
let deck = [];
let history = [];

// Initialize full 8-deck shoe
function initializeMachine() {
  deck = [];
  history = [];
  const cards = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  for (let d = 0; d < 8; d++) { // 8 decks
    cards.forEach(c => {
      for (let i = 0; i < 4; i++) { // 4 suits
        deck.push(c);
      }
    });
  }
  updateDeckDisplay();
  document.getElementById("history").innerText = "-";
  document.getElementById("nextCard").innerText = "-";
}

// Simple riffle shuffle
function shuffleDeck() {
  if (deck.length < 2) return;
  let mid = Math.floor(deck.length / 2);
  let firstHalf = deck.slice(0, mid);
  let secondHalf = deck.slice(mid);
  let shuffled = [];
  while (firstHalf.length || secondHalf.length) {
    if (secondHalf.length) shuffled.push(secondHalf.shift());
    if (firstHalf.length) shuffled.push(firstHalf.shift());
  }
  deck = shuffled;
  updateDeckDisplay();
}

// Deal cards
function dealCards(count) {
  if (deck.length === 0) return alert("Deck empty!");
  let dealt = deck.splice(0, count);
  document.getElementById("nextCard").innerText = dealt.join(", ");
  history = history.concat(dealt);
  document.getElementById("history").innerText = history.join(", ");
  updateDeckDisplay();
}

// Shuffle back history into middle of deck
function shuffleBack() {
  if (history.length === 0) return alert("No history to shuffle back!");
  let mid = Math.floor(deck.length / 2);
  let before = deck.slice(0, mid);
  let after = deck.slice(mid);
  // Randomly interleave history
  while (history.length) {
    let card = history.shift();
    if (Math.random() > 0.5) before.push(card); else after.unshift(card);
  }
  deck = before.concat(after);
  document.getElementById("history").innerText = "-";
  updateDeckDisplay();
}

// Reset everything
function resetDeck() {
  deck = [];
  history = [];
  document.getElementById("deckList").innerText = "Empty";
  document.getElementById("nextCard").innerText = "-";
  document.getElementById("probabilities").innerText = "-";
  document.getElementById("history").innerText = "-";
}

// Update deck + probabilities
function updateDeckDisplay() {
  document.getElementById("deckList").innerText = deck.join(", ") || "Empty";
  updateProbabilities();
}

// Calculate probabilities
function updateProbabilities() {
  if (deck.length === 0) {
    document.getElementById("probabilities").innerText = "-";
    return;
  }
  let counts = {};
  deck.forEach(card => { counts[card] = (counts[card] || 0) + 1; });
  let probs = [];
  for (let card in counts) {
    let percent = ((counts[card] / deck.length) * 100).toFixed(1);
    probs.push(`${card}: ${percent}%`);
  }
  document.getElementById("probabilities").innerText = probs.join(", ");
}
</script>
</body>
</html>
